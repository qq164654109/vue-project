!function(b,Y){"use strict";var N="ht",t=N+".layout.",s=b[N]||module.parent.exports.ht,y=s.List,w=s.DataModel,Q=s.Node,M=s.Edge,x=s.Group,A=Math,T=A.sqrt,X=A.random,k=A.max,O=A.min,v=function(I){return I*I};s.Default.getInternal().addMSMap({ms_force:function(z){z._interval=50,z._stepCount=10,z._motionLimit=.01,z._edgeRepulsion=.65,z._nodeRepulsion=.65,z._damper=1,z._maxMotion=0,z._motionRatio=0,z.init=function(T){var Y=this;T instanceof w?Y.dm=T:Y.gv=T,Y._nodeMap={},Y._nodes=new y,Y._edges=new y},z.start=function(){var R=this,S=R.gv;if(!R._timer){var z=R.cdm=S?S.dm():R.dm;z.mm(R.handleDataModelChange,R),z.md(R.handleDataPropertyChange,R),S&&S.mp(R.handleGV,R),z.each(function(J){if(R.isVisible(J)&&R.isLayoutable(J)&&J instanceof Q)if(R instanceof V){var v=J.p3();J.p3([v[0]+X(),v[1]+X(),v[2]+X()])}else v=J.p(),J.p(v.x+X(),v.y+X())}),R._timer=setInterval(function(){R.relax()},R._interval),R._damper=1}},z.stop=function(){var P=this;P._timer&&(P.cdm.umm(P.handleDataModelChange,P),P.cdm.umd(P.handleDataPropertyChange,P),P.gv&&P.gv.ump(P.handleGV,P),clearInterval(P._timer),delete P._timer,delete P.cdm)},z.handleGV=function(S){var $=this;if("dataModel"===S.property){var D=S.oldValue,j=S.newValue;D&&(D.umm($.handleDataModelChange,$),D.umd($.handleDataPropertyChange,$)),this.cdm=j,j.mm($.handleDataModelChange,$),j.md($.handleDataPropertyChange,$)}},z.relax=function(){var B=this;if(!(B._damper<.1&&B._maxMotion<B._motionLimit)){this.cdm.each(function($){B.isVisible($)&&($ instanceof M?B.addEdge($):$ instanceof Q&&B.addNode($))});for(var y,$,Z=0,R=B._edges,c=B._nodes,T=c.size();Z<B._stepCount;Z++){for(R.each(B.relaxEdge,B),y=0;T>y;y++)for($=0;T>$;$++)B.relaxNode(c.get(y),c.get($));B.moveNode()}B._isAdjusting=1,c.each(function(F){F.fix||(F.p?F.v.p3(F.p):F.v.p(F.x,F.y))}),delete B._isAdjusting,B._nodeMap={},c.clear(),R.clear(),B.onRelaxed()}},z.onRelaxed=function(){},z.isRunning=function(){return!!this._timer},z.isVisible=function(G){return G.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(G):!0},z.isLayoutable=function(W){if(W.s("layoutable")===!1)return!1;if(W instanceof x)return!1;var p=this;return p.gv?p.gv.isMovable(W)&&!p.gv.isSelected(W):!(p.cdm||p.dm).sm().co(W)},z.getNodeRepulsion=function(){return this._nodeRepulsion},z.setNodeRepulsion=function(c){this._nodeRepulsion=c,this._damper=1},z.getEdgeRepulsion=function(){return this._edgeRepulsion},z.setEdgeRepulsion=function(H){this._edgeRepulsion=H,this._damper=1},z.getStepCount=function(){return this._stepCount},z.setStepCount=function(D){this._stepCount=D,this._damper=1},z.getInterval=function(){return this._interval},z.setInterval=function(n){var M=this;M._interval!==n&&(M._interval=n,M._timer&&(clearInterval(M._timer),M._timer=setInterval(function(){M.relax()},n)))},z.handleDataPropertyChange=function(k){!this._isAdjusting&&this.isVisible(k.data)&&(this._damper=1)},z.handleDataModelChange=function(){this._damper=1},z.damp=function(){var X=this._maxMotion,V=this._damper;this._motionRatio<=.001&&((.2>X||X>1&&.9>V)&&V>.01?this._damper-=.01:.4>X&&V>.003?this._damper-=.003:V>1e-4&&(this._damper-=1e-4)),X<this._motionLimit&&(this._damper=0)}}}),s.layout.ForceLayout=function(v){this.init(v)},s.Default.def(t+"ForceLayout",Y,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(V){this._limitBounds=V,this._damper=1},getNodeSize:function(b){var x=this.gv;return x&&x.getDataUIBounds?x.getDataUIBounds(b):b.getRect()},addNode:function(J){var W=this,E=W._nodeMap[J._id];if(E)return E;var o=J.p();E={v:J,x:o.x,y:o.y,dx:0,dy:0,fix:!W.isLayoutable(J),s:W.getNodeSize(J)};var x=E.s,G=T(v(x.width)+v(x.height))*W._nodeRepulsion;return E.r=1>G?100:G,W._nodeMap[J._id]=E,W._nodes.add(E),E},addEdge:function(Y){if(Y._40I&&Y._41I){var _=this,x=_.addNode(Y._40I),C=_.addNode(Y._41I),j={s:x,t:C};C=C.s,x=x.s;var V=C.width+x.width,A=C.height+x.height;j.length=T(V*V+A*A)*_._edgeRepulsion,j.length<=0&&(j.length=100),_._edges.add(j)}},relaxEdge:function(a){var v=a.t,W=a.s,c=v.x-W.x,O=v.y-W.y,t=T(c*c+O*O),o=100*a.length,M=.25*c/o*t,U=.25*O/o*t;v.dx=v.dx-M,v.dy=v.dy-U,W.dx=W.dx+M,W.dy=W.dy+U},relaxNode:function(Z,U){if(Z!==U){var z=0,r=0,D=Z.x-U.x,W=Z.y-U.y,q=D*D+W*W;0===q?(z=X(),r=X()):36e4>q&&(z=D/q,r=W/q);var t=Z.r*U.r/400;z*=t,r*=t,Z.dx+=z,Z.dy+=r,U.dx-=z,U.dy-=r}},moveNode:function(){var s=this,E=s._limitBounds,h=s._maxMotion,B=0,g=s._damper;s._nodes.each(function(D){if(!D.fix){var M=D.dx*g,u=D.dy*g;if(D.dx=M/2,D.dy=u/2,B=k(T(M*M+u*u),B),D.x+=k(-40,O(40,M)),D.y+=k(-40,O(40,u)),E){D.x<E.x&&(D.x=E.x,s.adjust(1,0)),D.y<E.y&&(D.y=E.y,s.adjust(0,1));var Q=D.s;D.x+Q.width>E.x+E.width&&(D.x=E.x+E.width-Q.width,s.adjust(-1,0)),D.y+Q.height>E.y+E.height&&(D.y=E.y+E.height-Q.height,s.adjust(0,-1))}}}),s._maxMotion=B,s._motionRatio=B>0?h/B-1:0,s.damp()},adjust:function(r,h){var S=this._limitBounds;this._nodes.each(function(d){r>0?(!S||d.x+d.s.width+r<S.x+S.width)&&(d.x+=r):(!S||d.x+r>S.x)&&(d.x+=r),h>0?(!S||d.y+d.s.height+h<S.y+S.height)&&(d.y+=h):(!S||d.y+h>S.y)&&(d.y+=h)})}});var V=s.layout.Force3dLayout=function(u){this.init(u)};s.Default.def(t+"Force3dLayout",Y,{ms_force:1,getNodeSize3d:function(D){return D.s3()},addNode:function(w){var o=this,R=o._nodeMap[w._id];if(R)return R;R={v:w,p:w.p3(),d:[0,0,0],fix:!o.isLayoutable(w),s:o.getNodeSize3d(w)};var k=R.s,S=s.Default.getDistance(k)*o._nodeRepulsion;return R.r=1>S?100:S,o._nodeMap[w._id]=R,o._nodes.add(R),R},addEdge:function(u){if(u._40I&&u._41I){var t=this,l=t.addNode(u._40I),P=t.addNode(u._41I),J={s:l,t:P};P=P.s,l=l.s,J.length=T(v(P[0]+l[0])+v(P[1]+l[1])+v(P[2]+l[2]))*t._edgeRepulsion,J.length<=0&&(J.length=100),t._edges.add(J)}},relaxEdge:function(V){var r=V.t.p,Q=V.s.p,u=V.t.d,q=V.s.d,C=r[0]-Q[0],m=r[1]-Q[1],J=r[2]-Q[2],e=T(C*C+m*m+J*J),b=100*V.length,s=.25*C/b*e,i=.25*m/b*e,d=.25*J/b*e;u[0]-=s,u[1]-=i,u[2]-=d,q[0]+=s,q[1]+=i,q[2]+=d},relaxNode:function(Q,Z){if(Q!==Z){var E=Q.p,d=Z.p,P=0,y=0,g=0,v=E[0]-d[0],M=E[1]-d[1],L=E[2]-d[2],p=v*v+M*M+L*L;0===p?(P=X(),y=X(),g=X()):216e6>p&&(P=v/p,y=M/p,g=L/p);var w=Q.r*Z.r/400,r=Q.d,b=Z.d;P*=w,y*=w,g*=w,r[0]+=P,r[1]+=y,r[2]+=g,b[0]-=P,b[1]-=y,b[2]-=g}},moveNode:function(){var z=this,f=z._maxMotion,E=0,F=z._damper;z._nodes.each(function(P){if(!P.fix){var S=P.p,g=P.d,m=g[0]*F,n=g[1]*F,l=g[2]*F;g[0]=m/2,g[1]=n/2,g[2]=l/2,E=k(T(m*m+n*n+l*l),E),S[0]+=k(-40,O(40,m)),S[1]+=k(-40,O(40,n)),S[2]+=k(-40,O(40,l))}}),z._maxMotion=E,z._motionRatio=E>0?f/E-1:0,z.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);